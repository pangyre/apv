#!/usr/bin/env perl
use warnings;
use strict;
use MIME::Base64;
use Image::ExifTool;
use Path::Class qw( file );

#---------------------------------------------------------------------

my $img = file(shift || die "Give me an image file.\n");

die "That's too big for this kind of thing, don't you think?\n"
    if -s $img > 2 * 1_024;

my $exif = Image::ExifTool->new;

my $info = $exif->ImageInfo($img->stringify);

my $src = sprintf "data:%s;base64,%s",
    $info->{MIMEType},
    encode_base64($img->slurp);

$src =~ s/\R//g;

print $src, $/;

exit 0;

__DATA__
